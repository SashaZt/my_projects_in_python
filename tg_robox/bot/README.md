Структура Telegram-бота для продажи карт оплаты
Обзор проекта
Этот Telegram-бот предназначен для продажи карт оплаты различных сервисов с интеграцией платежной системы Portmone. Бот позволяет пользователям выбирать карты различных номиналов, оплачивать их и получать коды после успешной оплаты.
Структура файлов
Корневые файлы
ФайлОписание__init__.pyЭкспорт основных компонентов для удобства импортаconfig.pyЗагрузка и хранение конфигурации из различных источников (env, json)logger.pyНастройка системы логированияmain.pyОсновная точка входа, инициализация и запуск ботаrequirements.txtЗависимости проекта для pipDockerfileИнструкции для сборки Docker-образа
Модуль базы данных (db/)
ФайлОписаниеdatabase.pyФункции для работы с SQLAlchemy, создание соединений и сессий__init__.pyИнициализация модуля БДmodels.pyORM модели: User, CardCategory, CardValue, Order, Payment, CardCode
Обработчики сообщений (handlers/)
ФайлОписание__init__.pyРегистрация всех обработчиков в диспетчереstart.pyОбработка команды /start и регистрация пользователейmenu.pyГлавное меню и его разделыbuy.pyПроцесс выбора и покупки картsupport.pyРаздел FAQ и поддержкиuser_purchases.pyИстория покупок пользователя
Клавиатуры (keyboards/)
ФайлОписание__init__.pyИмпорт клавиатур для удобства доступаreply.pyКлавиатуры с кнопками для основного менюinline.pyИнлайн-клавиатуры для интерактивного взаимодействия
Middleware (middlewares/)
ФайлОписание__init__.pyНастройка и регистрация middlewaredatabase.pyMiddleware для доступа к БДthrottling.pyОграничение частоты запросов
Утилиты (utils/)
ФайлОписание__init__.pyИнициализация модуля утилитstates.pyСостояния FSM для диалоговnotifications.pyФункции для отправки уведомлений
Принцип работы

Запуск и инициализация:

Загрузка конфигурации из .env или config.json
Инициализация соединения с базой данных
Настройка логгера и middleware
Регистрация обработчиков сообщений


Взаимодействие с пользователем:

Пользователь запускает бота командой /start
Бот показывает главное меню с доступными разделами
Все сообщения проходят через middleware для ограничения частоты и добавления сессии БД


Процесс покупки:

Выбор номинала карты
Создание заказа в БД
Перенаправление на оплату через Portmone
Получение уведомления о статусе платежа
Отправка кода карты пользователю


Административные функции:

Управление доступными картами
Анализ статистики продаж
Отправка уведомлений пользователям




bot/
├── config.py                # Конфигурация бота и подключений
├── db/                      # Модуль работы с базой данных
│   ├── database.py          # Утилиты для работы с БД
│   ├── __init__.py          # Инициализация модуля БД
│   └── models.py            # ORM модели
├── Dockerfile               # Конфигурация для сборки Docker-образа
├── handlers/                # Обработчики сообщений бота
│   ├── buy.py               # Логика покупки карт
│   ├── __init__.py          # Регистрация всех обработчиков
│   ├── menu.py              # Обработчик главного меню
│   ├── start.py             # Обработчик команды /start
│   ├── support.py           # Раздел FAQ и поддержки
│   └── user_purchases.py    # Управление покупками пользователя
├── keyboards/               # Клавиатуры для бота
│   ├── __init__.py          # Импорт всех клавиатур
│   ├── inline.py            # Инлайн-клавиатуры
│   └── reply.py             # Клавиатуры с кнопками
├── logger.py                # Настройка логирования
├── main.py                  # Основной файл бота
├── middlewares/             # Middleware компоненты
│   ├── database.py          # Middleware для работы с БД
│   ├── __init__.py          # Настройка и регистрация middlewares
│   └── throttling.py        # Ограничение частоты запросов
├── requirements.txt         # Зависимости проекта
└── utils/                   # Вспомогательные утилиты
    ├── __init__.py          # Инициализация модуля утилит
    ├── notifications.py     # Функции для отправки уведомлений
    └── states.py            # Состояния FSM для диалогов
Описание каждого файла
Корневые файлы

config.py - Модуль для загрузки и хранения конфигурации из различных источников (env, json). Содержит настройки бота, базы данных и сторонних сервисов.
logger.py - Настройка системы логирования с ротацией файлов и выводом в консоль.
main.py - Основная точка входа в приложение. Инициализирует бота, базу данных, обработчики и запускает поллинг.
requirements.txt - Список зависимостей Python для установки через pip.
Dockerfile - Инструкции для сборки Docker-образа бота.

Модуль базы данных (db/)

database.py - Функции для создания асинхронного движка SQLAlchemy, фабрики сессий и инициализации моделей.
models.py - ORM модели для базы данных: User, CardCategory, CardValue, Order, Payment, CardCode.
init.py - Инициализация модуля базы данных, экспорт основных классов.

Обработчики сообщений (handlers/)

start.py - Обработчик команды /start, регистрация новых пользователей, показ приветственного сообщения.
menu.py - Обработчик главного меню и его разделов (бонусы, розыгрыши).
buy.py - Весь процесс покупки: выбор карты, оформление заказа, интеграция с платежной системой.
support.py - Раздел FAQ и поддержки с ответами на частые вопросы.
user_purchases.py - Показ истории покупок пользователя.
init.py - Регистрация всех роутеров в диспетчере.

Клавиатуры (keyboards/)

reply.py - Обычные клавиатуры (ReplyKeyboardMarkup) для основных разделов.
inline.py - Инлайн-клавиатуры (InlineKeyboardMarkup) для выбора номиналов, оплаты и т.д.
init.py - Импорт клавиатур для удобного доступа из других модулей.

Middlewares (middlewares/)

database.py - Middleware для получения сессии базы данных в обработчиках.
throttling.py - Middleware для ограничения частоты запросов от пользователей.
__init__.py - Функция setup_middlewares для регистрации middleware в диспетчере.

Утилиты (utils/)

states.py - Классы состояний для машины конечных состояний (FSM).
notifications.py - Функции для отправки уведомлений пользователям и администраторам.
init.py - Инициализация модуля утилит.